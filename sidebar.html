<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CodeMentor AI</title>
  <link rel="stylesheet" href="styles/sidebar.css">
</head>
<body>

<!-- Consent overlay -->
<div class="cm-overlay" id="consentOverlay">
  <div class="cm-consent-card">
    <div class="cm-consent-logo">
      <img src="assets/logo-48.png" alt="CodeMentor">
      <span>CodeMentor AI</span>
    </div>
    <h2>Before you start</h2>
    <p>When you use AI features, the problem statement and your messages are sent to the configured AI provider (Google Gemini). Everything else stays on your device.</p>
    <a href="https://policies.google.com/privacy" target="_blank" class="cm-link">Google Privacy Policy â†—</a>
    <button id="consentAccept" class="cm-btn cm-btn--primary cm-btn--full">I understand, continue</button>
  </div>
</div>

<!-- API Key setup overlay -->
<div class="cm-overlay" id="apiKeyOverlay" style="display:none">
  <div class="cm-consent-card">
    <div class="cm-consent-logo">
      <img src="assets/logo-48.png" alt="CodeMentor">
      <span>CodeMentor AI</span>
    </div>
    <h2>API Key Required</h2>
    <p>Enter your Google Gemini API key to enable AI features. The key is stored locally and never sent anywhere except Google's API.</p>
    <input type="password" id="overlayApiKeyInput" class="cm-input" placeholder="AIzaâ€¦">
    <div class="cm-toast cm-toast--error" id="overlayApiKeyError" style="display:none">Invalid or empty key</div>
    <button id="overlayApiKeySave" class="cm-btn cm-btn--primary cm-btn--full" style="margin-top:12px">Save &amp; Continue</button>
    <button id="overlayApiKeySkip" class="cm-btn cm-btn--ghost cm-btn--full" style="margin-top:8px">Skip (limited mode)</button>
  </div>
</div>

<!-- Toast container -->
<div id="toastContainer" class="cm-toast-container"></div>

<!-- Main sidebar -->
<div class="cm-sidebar">

  <!-- Header -->
  <header class="cm-header">
    <div class="cm-header__left">
      <img src="assets/logo-32.png" alt="CM" class="cm-header__logo">
      <span class="cm-header__title">CodeMentor</span>
      <span class="cm-badge" id="platformBadge">â€”</span>
    </div>
    <button class="cm-icon-btn" id="closeSidebar" title="Close">âœ•</button>
  </header>

  <!-- Status strip -->
  <div class="cm-status-strip" id="statusStrip">
    <span class="cm-status-item" id="statusApi">
      <span class="cm-dot cm-dot--off"></span>API
    </span>
    <span class="cm-status-sep">Â·</span>
    <span class="cm-status-item" id="statusParse">
      <span class="cm-dot cm-dot--off"></span>Parse
    </span>
    <span class="cm-status-sep">Â·</span>
    <span class="cm-status-item" id="statusTimer">
      <span class="cm-dot cm-dot--off"></span><span id="statusTimerText">0:00</span>
    </span>
  </div>

  <!-- Problem info -->
  <div class="cm-problem" id="problemSection">
    <div class="cm-problem__title" id="problemTitle">Detecting problemâ€¦</div>
    <div class="cm-problem__meta">
      <span class="cm-difficulty" id="difficulty"></span>
    </div>
  </div>

  <!-- Tabs -->
  <nav class="cm-tabs" id="tabNav">
    <button class="cm-tab cm-tab--active" data-tab="chat">Chat</button>
    <button class="cm-tab" data-tab="hints">Hints</button>
    <button class="cm-tab" data-tab="progress">Progress</button>
    <button class="cm-tab" data-tab="settings">Settings</button>
  </nav>

  <!-- Tab content -->
  <div class="cm-tab-content">

    <!-- CHAT TAB -->
    <div class="cm-pane cm-pane--active" id="pane-chat">

      <!-- Stuck detector nudge -->
      <div class="cm-nudge" id="stuckNudge" style="display:none">
        <span class="cm-nudge__icon">ðŸ’¡</span>
        <div class="cm-nudge__body">
          <div class="cm-nudge__title">Still stuck?</div>
          <div class="cm-nudge__text" id="nudgeText">Check edge cases and constraints.</div>
        </div>
        <button class="cm-icon-btn cm-nudge__close" id="nudgeClose">âœ•</button>
      </div>

      <!-- Mistake radar chips -->
      <div class="cm-radar" id="mistakeRadar" style="display:none">
        <div class="cm-radar__label">Likely pitfalls:</div>
        <div class="cm-radar__chips" id="radarChips"></div>
      </div>

      <div class="cm-chat-messages" id="chatMessages">
        <div class="cm-msg cm-msg--ai">
          <div class="cm-msg__avatar">ðŸŽ¯</div>
          <div class="cm-msg__bubble">
            Hi! I'm CodeMentor. What's your approach to this problem? I'll guide you without spoiling the answer.
          </div>
        </div>
      </div>

      <!-- Explain this line bar -->
      <div class="cm-explain-bar" id="explainBar" style="display:none">
        <span class="cm-explain-bar__label">Code snippet detected</span>
        <button class="cm-btn cm-btn--xs cm-btn--accent" id="explainLinesBtn">Explain line-by-line</button>
        <button class="cm-icon-btn" id="explainBarClose">âœ•</button>
      </div>

      <div class="cm-chat-input">
        <textarea id="userInput" class="cm-textarea" rows="2" placeholder="Ask me anythingâ€¦"></textarea>
        <button id="sendMessage" class="cm-btn cm-btn--primary">Send</button>
      </div>
    </div>

    <!-- HINTS TAB -->
    <div class="cm-pane" id="pane-hints">
      <div class="cm-hints">
        <div class="cm-hints__header">
          <div>
            <div class="cm-hints__title">Hint Ladder</div>
            <div class="cm-hints__sub">Progressive reveals â€” no full solution</div>
          </div>
          <label class="cm-toggle-label" title="Lock to prevent further reveals">
            <input type="checkbox" id="hintLockToggle"> Lock
          </label>
        </div>

        <div class="cm-hint-rungs" id="hintRungs">
          <div class="cm-rung cm-rung--locked" id="rung-1">
            <div class="cm-rung__header">
              <span class="cm-rung__num">1</span>
              <span class="cm-rung__label">Intuition</span>
              <span class="cm-rung__status">Locked</span>
            </div>
          </div>
          <div class="cm-rung cm-rung--locked" id="rung-2">
            <div class="cm-rung__header">
              <span class="cm-rung__num">2</span>
              <span class="cm-rung__label">Approach Outline</span>
              <span class="cm-rung__status">Locked</span>
            </div>
          </div>
          <div class="cm-rung cm-rung--locked" id="rung-3">
            <div class="cm-rung__header">
              <span class="cm-rung__num">3</span>
              <span class="cm-rung__label">Key Observation</span>
              <span class="cm-rung__status">Locked</span>
            </div>
          </div>
          <div class="cm-rung cm-rung--locked" id="rung-4">
            <div class="cm-rung__header">
              <span class="cm-rung__num">4</span>
              <span class="cm-rung__label">Pseudo-code</span>
              <span class="cm-rung__status">Locked</span>
            </div>
          </div>
        </div>

        <button class="cm-btn cm-btn--primary cm-btn--full" id="nextHintBtn">Next Hint â†’</button>
        <div class="cm-hints__count"><span id="hintsUsed">0</span> of 4 revealed</div>
      </div>
    </div>

    <!-- PROGRESS TAB -->
    <div class="cm-pane" id="pane-progress">

      <div class="cm-card">
        <div class="cm-card__label">Session Timer</div>
        <div class="cm-timer" id="timer">00:00</div>
        <div class="cm-timer-controls">
          <button class="cm-btn cm-btn--sm cm-btn--success" id="startTimer">Start</button>
          <button class="cm-btn cm-btn--sm cm-btn--warn" id="pauseTimer">Pause</button>
          <button class="cm-btn cm-btn--sm cm-btn--danger" id="resetTimer">Reset</button>
        </div>
      </div>

      <div class="cm-card">
        <div class="cm-card__label">Session Stats</div>
        <div class="cm-stat-row"><span>Time</span><span id="statTime">0 min</span></div>
        <div class="cm-stat-row"><span>Hints revealed</span><span id="statHints">0</span></div>
        <div class="cm-stat-row"><span>Messages sent</span><span id="statMessages">0</span></div>
        <div class="cm-stat-row"><span>Approaches</span><span id="statApproaches">0</span></div>
      </div>

      <div class="cm-card" id="approachComparatorCard" style="display:none">
        <div class="cm-card__label">Approach Comparator</div>
        <div class="cm-comparator" id="comparatorTable"></div>
      </div>

      <div class="cm-card">
        <div class="cm-card__label">Session Replay</div>
        <p class="cm-card__text">Export a markdown summary: problem, approaches, insights, pitfalls, next steps.</p>
        <button class="cm-btn cm-btn--accent cm-btn--full" id="copySessionBtn">Copy Session Summary</button>
      </div>

      <div class="cm-card">
        <div class="cm-card__label">My Data</div>
        <p class="cm-card__text">Clears all local data: chat, timer, hints, settings.</p>
        <button class="cm-btn cm-btn--danger cm-btn--full" id="clearData">Clear all my data</button>
      </div>
    </div>

    <!-- SETTINGS TAB -->
    <div class="cm-pane" id="pane-settings">

      <div class="cm-card">
        <div class="cm-card__label">Gemini API Key</div>
        <p class="cm-card__text">Stored locally only â€” never shared with CodeMentor servers.</p>
        <div class="cm-api-key-row">
          <input type="password" id="apiKeyInput" class="cm-input" placeholder="AIzaâ€¦">
          <button class="cm-btn cm-btn--primary" id="saveApiKey">Save</button>
        </div>
      </div>

      <div class="cm-card">
        <div class="cm-card__label">Stuck Detector</div>
        <div class="cm-setting-row">
          <label>Enable stuck detector</label>
          <label class="cm-switch">
            <input type="checkbox" id="stuckEnabled" checked>
            <span class="cm-switch__track"></span>
          </label>
        </div>
        <div class="cm-setting-row">
          <label>Nudge after (minutes)</label>
          <input type="number" id="stuckThreshold" class="cm-input cm-input--sm" value="15" min="5" max="60">
        </div>
      </div>

      <div class="cm-card">
        <div class="cm-card__label">Preferences</div>
        <div class="cm-setting-row">
          <label>Mistake radar</label>
          <label class="cm-switch">
            <input type="checkbox" id="mistakeRadarEnabled" checked>
            <span class="cm-switch__track"></span>
          </label>
        </div>
      </div>

      <!-- Diagnostics -->
      <div class="cm-card cm-card--diag">
        <div class="cm-card__label">Diagnostics</div>
        <div class="cm-diag-row"><span>Platform</span><span id="diagPlatform">â€”</span></div>
        <div class="cm-diag-row"><span>Page type</span><span id="diagPageType">â€”</span></div>
        <div class="cm-diag-row"><span>Title length</span><span id="diagTitleLen">â€”</span></div>
        <div class="cm-diag-row"><span>Statement length</span><span id="diagStmtLen">â€”</span></div>
        <div class="cm-diag-row"><span>Last extracted</span><span id="diagTimestamp">â€”</span></div>
        <div class="cm-diag-row"><span>Last error</span><span id="diagError" class="cm-diag-error">â€”</span></div>
      </div>
    </div>

  </div><!-- /.cm-tab-content -->
</div><!-- /.cm-sidebar -->

<script src="sidebar.js"></script>
</body>
</html>
